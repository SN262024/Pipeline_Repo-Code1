on: 
  push:
    branches: 
      - 'feature/**'
      - 'main'
      - 'hotfix/**'

permissions:
  id-token: write   # Required for OIDC
  contents: read    # Required for actions/checkout      

jobs:
  MyfirstJob: 
    name: My job
    runs-on: [self-hosted, surendra-runner]

    steps:
    - name: Hello Reliance family!
      run: echo "Surendra Maharaj"

    - name: Azure Login
      uses: Azure/login@v2
      with:
        client-id: ${{ secrets.AZURE_CLIENT_ID }}
        tenant-id: ${{ secrets.AZURE_TENANT_ID }}
        subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

    - name: Install Terraform
      uses: little-core-labs/install-terraform@v2.0.0
      with:
        version: 1.3.0   # use valid version (latest stable is ~1.9.8)

    - name: Terraform fmt
      id: fmt
      working-directory: Git_Rivision
      run: terraform fmt -check
      continue-on-error: true

    - name: Terraform Init
      id: init
      working-directory: Git_Rivision
      run: terraform init -input=false

    - name: Terraform Validate
      id: validate
      working-directory: Git_Rivision
      run: terraform validate -no-color

    - name: Terraform Plan
      id: plan
      working-directory: Git_Rivision
      run: terraform plan -no-color -input=false
      continue-on-error: true
